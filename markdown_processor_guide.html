<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia at 2022-12-09 
 | Rendered using Apache Maven Fluido Skin 1.3.1
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20221209" />
    <meta http-equiv="Content-Language" content="en" />
    <title>CONFLUENCE-REPORTING::Plugin &#x2013; Introduction</title>
    <link rel="stylesheet" href="./css/apache-maven-fluido-1.3.1.min.css" />
    <link rel="stylesheet" href="./css/site.css" />
    <link rel="stylesheet" href="./css/print.css" media="print" />

      
    <script type="text/javascript" src="./js/apache-maven-fluido-1.3.1.min.js"></script>

    
                  </head>
        <body class="topBarDisabled">
          
                
                    
    
        <div class="container-fluid">
          <div id="banner">
        <div class="pull-left">
                                <div id="bannerLeft">
                <h2>CONFLUENCE-REPORTING::Plugin</h2>
                </div>
                      </div>
        <div class="pull-right">  </div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
                
                    
                  <li id="publishDate">Last Published: 2022-12-09
                      <span class="divider">|</span>
                   </li>
                  <li id="projectVersion">Version: 7.8
                      </li>
                      
                
                    
      
                            </ul>
      </div>

            
      <div class="row-fluid">
        <div id="leftColumn" class="span3">
          <div class="well sidebar-nav">
                
                    
                <ul class="nav nav-list">
                    <li class="nav-header">Overview</li>
                              
      <li>
  
                          <a href="project-summary.html" title="Summary">
          <i class="none"></i>
        Summary</a>
            </li>
                
      <li>
  
                          <a href="plugin-info.html" title="Goals">
          <i class="none"></i>
        Goals</a>
            </li>
                
      <li>
  
                          <a href="usage.html" title="Usage">
          <i class="none"></i>
        Usage</a>
            </li>
                
      <li>
  
                          <a href="site_xml_guide.html" title="Use XML Site Definition">
          <i class="none"></i>
        Use XML Site Definition</a>
            </li>
                
      <li>
  
                          <a href="site_yaml_guide.html" title="Use YAML Site Definition">
          <i class="none"></i>
        Use YAML Site Definition</a>
            </li>
                
      <li>
  
                          <a href="site_json_guide.html" title="Use JSON Site Definition">
          <i class="none"></i>
        Use JSON Site Definition</a>
            </li>
                              <li class="nav-header">Format</li>
                              
      <li>
  
                          <a href="markdown_guide.html" title="Markdown Syntax Support">
          <i class="none"></i>
        Markdown Syntax Support</a>
            </li>
                
      <li>
  
                          <a href="Notation Guide - Confluence.html" title="Confluence Wiki support">
          <i class="none"></i>
        Confluence Wiki support</a>
            </li>
                
      <li>
  
                          <a href="storageformat_guide.html" title="Storage Format Support">
          <i class="none"></i>
        Storage Format Support</a>
            </li>
                              <li class="nav-header">Processor</li>
                              
      <li>
  
                          <a href="site_processor_guide.html" title="Site Processor">
          <i class="none"></i>
        Site Processor</a>
            </li>
                
      <li class="active">
  
            <a href="#"><i class="none"></i>Markdown Processor</a>
          </li>
                              <li class="nav-header">Summary</li>
                              
      <li>
  
                          <a href="dependencies.html" title="Dependencies">
          <i class="none"></i>
        Dependencies</a>
            </li>
                
      <li>
  
                          <a href="source-repository.html" title="Source">
          <i class="none"></i>
        Source</a>
            </li>
                              <li class="nav-header">Javadoc</li>
                              
      <li>
  
                          <a href="core/apidocs/index.html" title="core">
          <i class="none"></i>
        core</a>
            </li>
            </ul>
                
                    
                
          <hr />

           <div id="poweredBy">
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                            <div class="clear"></div>
                             <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
                  </div>
          </div>
        </div>
        
                
        <div id="bodyColumn"  class="span9" >
                                  
            <h1>Introduction</h1>
<p>From <b>release 6.8</b> we have the possibility to plug different <b>Markdown Processor</b> so you can add extra features other than which provided built-in. Such processor can be plugged into processing using a module (i.e. <i>java library</i>) containing processor implementation that is published using <a class="externalLink" href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html">Java Service Provide Interface (SPI)</a> specification.</p>
<div class="section">
<h2><a name="Markdown_processor_usage"></a>Markdown processor usage</h2>
<p>Currently the available Markdown processors compliant with plugin are:</p>

<ol style="list-style-type: decimal">
  
<li>
<p><a class="externalLink" href="https://github.com/sirthias/pegdown">Pegdown</a></p>
  
<blockquote>This implementation is the default one. Since it has been <b>DEPRECATED</b> we encourage to plug the new <b>Commonmark</b> implementation because in the next major release pegdown will be removed
  </blockquote></li>
  
<li>
<p><a class="externalLink" href="https://github.com/atlassian/commonmark-java">Commonmark</a></p>
  
<blockquote>Is the new implementation available from plugin version <tt>6.8</tt>
  </blockquote></li>
</ol>
<div class="section">
<h3><a name="Configure_a_new_Markdown_Processor"></a>Configure a new Markdown Processor</h3>
<p>To plug a <b>markdown processor</b> you have to declare library <b>as plugin&#x2019;s dependency</b>. </p>
<div class="section">
<h4><a name="Plug_commonmark_implementation"></a>Plug <tt>commonmark</tt> implementation</h4>

<div class="source">
<div class="source">
<pre>&lt;plugin&gt;
    &lt;groupId&gt;org.bsc.maven&lt;/groupId&gt;
    &lt;artifactId&gt;confluence-reporting-maven-plugin&lt;/artifactId&gt;
    &lt;version&gt;${confluence.plugin.version}&lt;/version&gt;
    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.bsc.maven&lt;/groupId&gt;
            &lt;artifactId&gt;confluence-markdown-processor-commonmark&lt;/artifactId&gt;
            &lt;version&gt;${confluence.plugin.version}&lt;/version&gt;
            &lt;scope&gt;runtime&lt;/scope&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;
    &lt;configuration&gt;
        &lt;wikiFilesExt&gt;.confluence&lt;/wikiFilesExt&gt;
        &lt;siteDescriptor&gt;${basedir}/src/site/confluence/site.yml&lt;/siteDescriptor&gt;
        &lt;failOnError&gt;true&lt;/failOnError&gt;
        &lt;markdownProcessor&gt;
            &lt;name&gt;commonmark&lt;/name&gt;
        &lt;/markdownProcessor&gt;
    &lt;/configuration&gt;
&lt;/plugin&gt;
</pre></div></div></div></div></div>
<div class="section">
<h2><a name="Implement_a_new_Markdown_processor_service"></a>Implement a new &#x2018;Markdown processor&#x2019; service</h2>
<p>To implement a new <b>Markdown processor service</b> we have to follow steps below:</p>
<div class="section">
<h3><a name="a1._Create_a_new_Project"></a>1. Create a new Project</h3>
<p>Create a simple java library project maven compliant</p></div>
<div class="section">
<h3><a name="a2._Add_dependency_to_maven-confluence-core_module"></a>2. Add dependency to <b>maven-confluence-core</b> module</h3>

<div class="source">
<div class="source">
<pre>&lt;dependency&gt;
    &lt;groupId&gt;org.bsc.maven&lt;/groupId&gt;
    &lt;artifactId&gt;maven-confluence-core&lt;/artifactId&gt;
    &lt;version&gt;${version}&lt;/version&gt;
&lt;/dependency&gt;
</pre></div></div></div>
<div class="section">
<h3><a name="a3._Implement_the_interface_org.bsc.markdown.MarkdownProcessor"></a>3. Implement the interface <tt>org.bsc.markdown.MarkdownProcessor</tt></h3>
<p><b>MarkdownProcessor.java</b></p>

<div class="source">
<div class="source">
<pre>/**
 * Markdown Processor interface
 */
public interface MarkdownProcessor {

    /**
     * markdown processor identifier used to choose which procerror use at run-time
     *
     * @return identifier
     */
    String getName();

    /**
     * translate a markdown source in the confluence wiki counterpart
     *
     * @param context parse context 
     * @param content content to parse
     * @return translated confluence wiki format
     * @throws IOException
     */
    String processMarkdown( MarkdownParserContext context, String content ) throws IOException;
}
</pre></div></div>
<p><b>MarkdownParserContext.java</b></p>

<div class="source">
<div class="source">
<pre>public interface MarkdownParserContext {

    /**
     * The Site Model Object
     *
     * @return site object. nullable
     */
    default Optional&lt;Site&gt; getSite() { return empty(); }

    /**
     * the current Page Model Object
     *
     * @return  Page Model Object
     */
    default Optional&lt;Site.Page&gt; getPage() { return empty(); }

    /**
     * the page prefix to apply
     *
     * @return page prefix to apply. nullable
     */
    default Optional&lt;String&gt; getPagePrefixToApply() { return empty(); }

    /**
     * indicates whether the prefix ${page.title} should be added or not
     *
     * @return use the prefix
     */
    default boolean isLinkPrefixEnabled() { return true; }

}
</pre></div></div></div>
<div class="section">
<h3><a name="a4._Publish_implementation_following_SPI_specification"></a>4. Publish implementation following <a class="externalLink" href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html">SPI</a> specification</h3>
<p>The <a class="externalLink" href="https://docs.oracle.com/javase/tutorial/sound/SPI-intro.html">SPI</a> specification <b>publish a service creating a mapping file a mapping file in a specially named directory <tt>META-INF/services</tt></b>. The name of the file is the name of the SPI class being subclassed, and the file contains the names of the new subclasses of that SPI abstract class (see documentation for more details).</p>
<div class="section">
<h4><a name="META-INFservices_generator"></a>META-INF/services generator</h4>
<p>However there is a great library that extremely simplify publishing of SPI service named <a class="externalLink" href="http://metainf-services.kohsuke.org/">META-INF/services generator</a> that use behind the scene a <b>java annotation processor</b> that automatically generates the required mapping file using a java annotation <tt>@MetaInfServices</tt> as shown below</p>

<div class="source">
<div class="source">
<pre>@MetaInfServices(MarkdownProcessor.class)
public class CommonmarkMarkdownProcessorImpl implements MarkdownProcessor {

}
</pre></div></div></div></div></div>
                  </div>
            </div>
          </div>

    <hr/>

    <footer>
            <div class="container-fluid">
                      <div class="row-fluid">
                              <p >Copyright &copy;                    2022
                        <a href="http://soulsoftware-bsc.blogspot.it/">Bartolomeo Sorrentino</a>.
            All rights reserved.      
                    
      </p>
        </div>

        
        
                </div>
    </footer>
        </body>
</html>
